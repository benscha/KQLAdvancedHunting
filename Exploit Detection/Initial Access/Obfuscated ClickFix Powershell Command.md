# *Obfuscated ClickFix Powershell Command*

## Query Information

#### MITRE ATT&CK Technique(s)

| Technique ID | Title    | Link    |
| ---  | --- | --- |
| T1059.001 | Command and Scripting Interpreter: PowerShell | https://attack.mitre.org/techniques/T1059/001/ |

#### Description
This rule detects instances where 'powershell.exe', 'pwsh.exe', or 'conhost.exe' are launched by 'explorer.exe' with a command line containing an unusual number of spaces or tabs. This pattern can indicate obfuscation attempts often used by adversaries to hide malicious commands or scripts.

#### Risk
ClickFix Attack Detection

#### Author <Optional>
- **Name: Benjamin Zulliger**
- **Github: https://github.com/benscha/KQLAdvancedHunting**
- **LinkedIn: https://www.linkedin.com/in/benjamin-zulliger/**

#### References
- https://expel.com/blog/cache-smuggling-when-a-picture-isnt-a-thousand-words/


## Defender XDR
```KQL
DeviceProcessEvents
| where InitiatingProcessFileName =~ "explorer.exe" 
| where FileName in~ ( "powershell.exe", "pwsh.exe", "conhost.exe")
| where ProcessCommandLine matches regex @'(\s{5,}|\t{2,})'
| project Timestamp,DeviceId, DeviceName, InitiatingProcessFileName, InitiatingProcessCommandLine, FileName, ProcessCommandLine, AccountName, ReportId
```





