# *CLSID override*

## Query Information

#### MITRE ATT&CK Technique(s)

| Technique ID | Title    | Link    |
| ---  | --- | --- |
| T1574.001 | DLL | https://attack.mitre.org/techniques/T1574/001/ |
| TA0003 | Persistence | https://attack.mitre.org/tactics/TA0003/ |

#### Description

This rule detects modifications to the HKEY_CURRENT_USER\SOFTWARE\Classes\CLSID\{CLSID}\InProcServer32 registry key where the RegistryValueData ends with ".dll" and does not point to common system directories (%systemroot%, C:\Program Files (x86)\, C:\Program Files\). This behavior is indicative of CLSID hijacking, a technique used by adversaries to achieve persistence or privilege escalation by redirecting legitimate COM object calls to a malicious DLL

#### Author <Optional>
- **Name: Benjamin Zulliger**
- **Github: https://github.com/benscha/KQLAdvancedHunting**
- **LinkedIn: https://www.linkedin.com/in/benjamin-zulliger/**

#### References
- https://securelist.com/forumtroll-apt-hacking-team-dante-spyware/117851/


## Defender XDR
```KQL
// Based on https://securelist.com/forumtroll-apt-hacking-team-dante-spyware/117851/
//CVE-2025-2783 
DeviceRegistryEvents
| where ActionType == "RegistryValueSet"
| where RegistryKey startswith "HKEY_CURRENT_USER\\" and RegistryKey has "SOFTWARE\\Classes\\CLSID" and RegistryKey endswith "InProcServer32"
| where not(RegistryValueData has_any ("%systemroot%", "C:\\Program Files (x86)\\", "C:\\Program Files\\"))
| where RegistryValueData endswith ".dll"

```
